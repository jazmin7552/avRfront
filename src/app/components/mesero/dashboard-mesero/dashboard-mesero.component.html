<div class="dashboard-container">

  <!-- ========== ESQUINAS DECORATIVAS FIJAS ========== -->
  <div class="decorative-corner corner-tl"></div>
  <div class="decorative-corner corner-tr"></div>
  <div class="decorative-corner corner-bl"></div>
  <div class="decorative-corner corner-br"></div>

  <!-- ========== HEADER FIJO CON BOOTSTRAP ========== -->
  <header class="dashboard-header">
    <div class="container-fluid px-3 px-md-4 py-3">
      <div class="row align-items-center g-3">
        <div class="col-12 col-lg-6">
          <h1>ğŸ½ï¸ Buen SazÃ³n</h1>
        </div>
        <div class="col-12 col-lg-6">
          <div class="d-flex align-items-center justify-content-lg-end gap-2 gap-md-3 flex-wrap">
            <span class="badge user-name rounded-pill px-3 py-2">
              {{ meseroNombre }}
            </span>
            <button class="btn btn-logout rounded-pill px-3 px-md-4 py-2" (click)="cerrarSesion()">
              Salir
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ========== LOADING ========== -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando datos...</p>
  </div>

  <!-- ========== CONTENIDO PRINCIPAL CON SCROLL ========== -->
  <div class="main-content" *ngIf="!loading">
    <div class="container-fluid px-3 px-md-4 py-4">

      <!-- ========== ESTADÃSTICAS ========== -->
      <section class="stats-section">
        <h2>EstadÃ­sticas del DÃ­a</h2>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-3 g-md-4">

          <div class="col">
            <div class="card stat-card border-0 h-100">
              <div class="card-body p-3 p-md-4 d-flex align-items-center gap-3">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-info flex-grow-1">
                  <p class="stat-label mb-1">Mesas Atendidas</p>
                  <p class="stat-value mb-0">{{ estadisticas.mesasAtendidas }}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col">
            <div class="card stat-card border-0 h-100">
              <div class="card-body p-3 p-md-4 d-flex align-items-center gap-3">
                <div class="stat-icon">â³</div>
                <div class="stat-info flex-grow-1">
                  <p class="stat-label mb-1">Comandas Pendientes</p>
                  <p class="stat-value mb-0">{{ estadisticas.comandasPendientes }}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col">
            <div class="card stat-card border-0 h-100">
              <div class="card-body p-3 p-md-4 d-flex align-items-center gap-3">
                <div class="stat-icon">âœ…</div>
                <div class="stat-info flex-grow-1">
                  <p class="stat-label mb-1">Comandas Listas</p>
                  <p class="stat-value mb-0">{{ estadisticas.comandasCompletadas }}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col">
            <div class="card stat-card border-0 h-100">
              <div class="card-body p-3 p-md-4 d-flex align-items-center gap-3">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-info flex-grow-1">
                  <p class="stat-label mb-1">Total Vendido</p>
                  <p class="stat-value mb-0">${{ estadisticas.totalVendido | number:'1.0-0' }}</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- ========== ACCIONES RÃPIDAS ========== -->
      <section>
        <div class="d-flex flex-column flex-md-row gap-3 justify-content-center align-items-stretch">
          <button
            class="btn btn-action btn-primary rounded-pill px-4 px-md-5 py-3"
            (click)="nuevaComanda()">
            â• Nueva Comanda
          </button>
          <button
            class="btn btn-action btn-secondary rounded-pill px-4 px-md-5 py-3"
            (click)="verComandasActivas()">
            ğŸ“‹ Ver Comandas Activas
          </button>
        </div>
      </section>

      <!-- ========== MESAS ========== -->
      <section class="mesas-section">
        <h2>Estado de Mesas</h2>

        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-3 g-md-4">

          <div
            *ngFor="let mesa of mesas"
            class="col">
            <div
              class="card mesa-card border-0 h-100"
              [ngClass]="getMesaColor(mesa)"
              (click)="abrirMesa(mesa)">

              <div class="card-body p-3 p-md-4">

                <!-- Header de la mesa -->
                <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom border-opacity-25">
                  <span class="mesa-numero">Mesa {{ mesa.idMesa }}</span>
                  <span class="mesa-estado">
                    {{ getEstadoMesa(mesa) === 'disponible' ? 'âœ“' : 'ğŸ”´' }}
                  </span>
                </div>

                <!-- Capacidad -->
                <div class="mb-3">
                  <p class="mesa-capacidad mb-0">
                    ğŸ‘¥ Capacidad: {{ mesa.capacidad }} personas
                  </p>
                </div>

                <!-- Footer: Badge y Select -->
                <div class="d-flex flex-column gap-3 align-items-center">
                  <span
                    class="badge estado-badge rounded-pill w-100 text-center"
                    [ngClass]="getMesaColor(mesa)">
                    {{ getEstadoMesa(mesa) }}
                  </span>

                  <!-- SELECT para cambiar estado -->
                  <select
                    [value]="convertirEstadoTextoAIdPublico(mesa.estado)"
                    [disabled]="!puedeCambiarEstado(mesa)"
                    (change)="cambiarEstadoDesdSelect($event, mesa)"
                    (click)="$event.stopPropagation()"
                    class="form-select estado-select rounded-3 py-2 px-3 w-100"
                    [ngClass]="getMesaColor(mesa)">
                    <option [value]="1">DISPONIBLE</option>
                    <option [value]="2">OCUPADA</option>
                    <option [value]="3">RESERVADA</option>
                  </select>
                </div>

              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div class="col-12" *ngIf="mesas.length === 0">
            <div class="empty-state py-5">
              <p class="mb-0">No hay mesas registradas en el sistema</p>
            </div>
          </div>

        </div>
      </section>

      <!-- ========== COMANDAS ACTIVAS ========== -->
      <section class="comandas-resumen rounded-4 p-3 p-md-4" *ngIf="comandasActivas.length > 0">
        <h2>Mis Comandas Activas</h2>

        <div class="d-flex flex-column gap-3">
          <div
            *ngFor="let comanda of comandasActivas"
            class="comanda-item rounded-3 p-3 p-md-4"
            (click)="verComanda(comanda.mesaId)">

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 gap-md-3">

              <div class="d-flex align-items-center gap-3 flex-wrap">
                <span class="comanda-mesa">Mesa {{ comanda.mesaId }}</span>
                <span class="comanda-hora">{{ comanda.fecha | date:'HH:mm' }}</span>
              </div>

              <span
                class="badge comanda-estado rounded-pill px-3 py-2"
                [ngClass]="'estado-' + comanda.estadoNombre">
                {{ comanda.estadoNombre === 'PENDIENTE' ? 'Pendiente' :
                   comanda.estadoNombre === 'EN_PREPARACION' ? 'En preparaciÃ³n' :
                   comanda.estadoNombre === 'LISTA' ? 'Lista' : 'Completada' }}
              </span>

            </div>

          </div>
        </div>
      </section>

    </div>
  </div>

</div>
